ЦЕЛЬ:
проанализировать статистику повторных заказов, понять какие факторы являются ключевыми, предложить улучшения, протестировать их в симуляции.

Шаги:

1. Предобработка
Датасет был взят из Kaggle (https://www.kaggle.com/datasets/olistbr/brazilian-ecommerce) ,сведён из разных файлов, преобразован и на его основе создан новый для определения повторного заказа, с такими признаками как:
* город заказчика
* рейтинг отзыва
* категория товара
* продавец
* задержка (от предсказанного времени доставки)
* ожидание подтверждения заказа
* время доставки заказа

* и главный: (произошел ли) повторный заказ.

----------

 #   Column                         Non-Null Count  Dtype  
---  ------                         --------------  -----  
 0   customer_unique_id             93356 non-null  object 
 1   order_id                       93356 non-null  object 
 2   customer_id                    93356 non-null  object 
 3   customer_city                  93356 non-null  object 
 4   repeat_order                   93356 non-null  int64  
 5   review_score                   92732 non-null  float64
 6   product_category_name_english  93326 non-null  object 
 7   n_sellers                      93326 non-null  float64
 8   first_seller                   93326 non-null  object 
 9   delay                          93356 non-null  float64
 10  approval_time_hours            93343 non-null  float64
 11  delivery_time_days             93356 non-null  float64
----------

2. Модель
На датасете из первых заказов была обучена модель CatBoost. Выбор был сделан в ее пользу в силу главных преимуществ:

* сильная работа с категориальными признаками
* неприхотливость
* высокая точность наряду с Gradient Boosting
----------
Данные оказались довольно стохастичными, причем с сильным категориальным дисбалансом, вследствие чего приходилось либо сильно жертвовать precision, либо recall, либо идти на сомнительный компромисс, где оба показателя неприемлимо низки. Поэтому был выбран конфиг модели с высоким precision для выявления наиболее важных признаков. Получили такие результаты:

----------
ТОЧНОСТЬ:
              precision    recall  f1-score   support

           0       0.97      1.00      0.98     18076
           1       0.82      0.02      0.05       596
----------
ВАЖНОСТЬ ПРИЗНАКОВ:
                          feature  importance
5  product_categories_first_order   21.885048
6                    first_seller   20.746212
2             approval_time_hours   17.800061
1                           delay   12.961188
3              delivery_time_days   11.456349
4                   customer_city    8.955862
0                    review_score    6.195280
----------

3. Предложения по улучшению

Глядя на важность признаков заметим, что решающими признаками, которые маркетплейс в силах изменить, стали:
** время подтверждения заказа
* задержка доставки
* время доставки

проверим их значения:
----------
average approval time: 10.0 hours
average delay: -12.0 days
average delievery time: 12.0 days
----------

Видим что в целом доставка идет с нормальной скоростью и с ней нет проблем, но микроулучшение можно попробовать ввести. А вот со временем подтверждения ситуация очень и очень плачевная, и ее нужно сильно исправлять.
Предложения:
* ускорить (сократить) время доставки на 10%
* сократить время подтверждения на 50%

4. Симуляция

Для создания выборки мы берем реальные значения из тренировочной выборки, и имеем возможность регулировать параметры генерации:целевое среднее значение и множитель для количественных признаков, и вероятности генерации для категориальных признаков. 

Тестируем наши гипотезы, и чтобы убедиться в правильной логике симуляции, еще две:

----------
Main test: moderate improvements (approval_time -50%, delivery_time -10%)

Base mean_prob=0.0599, pred_rate=0.08%
Improved mean_prob=0.0653, pred_rate=0.08%
Change abs=+0.0054, rel=+9.0%

Check test: strong improvements (approval_time -80%, delivery_time -20%, review_score → 4.5)

Base mean_prob=0.0599, pred_rate=0.08%
Improved mean_prob=0.1906, pred_rate=8.15%
Change abs=+0.1307, rel=+218.0%

Check test: service degradation (approval_time +50%, delay = 5 days)

Base mean_prob=0.0599, pred_rate=0.08%
Improved mean_prob=0.0509, pred_rate=0.07%
Change abs=-0.0090, rel=-15.1%
----------

Мы убедились в правильной логике и получили результат - улучшение на 9%.

6. Итог

Были выведены важные признаки, проанализированы их свойства, приведены советы по улучшению, построена симуляция, и внутри нее были проверены гипотезы. 
Получили улучшение статистики повторных заказов на 9% путем сокращения времени ожидания на 50% и скорости доставки на 10%.

Использовали стандартные библиотеки, никаких API использовано не было.

ОГРАНИЧЕНИЯ:

Датасет при всем своем объеме не предоставил достаточно широкую выборку значений для обучения модели экстремальным изменениям. Также в датасете был огромный дисбаланс классов (3% - 97%), из-за чего было крайне трудно сделать высокий счет f1 метрики. По этой причине, вероятно, прогноз окажется не столь точным, каким мог бы быть в датасете с приемлимым дисбалансом и широкой дисперсией значений признаков
